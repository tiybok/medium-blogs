<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>HTTPD Service is not Idempotent in Nature -- Make it using Ansible</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">HTTPD Service is not Idempotent in Nature -- Make it using Ansible</h1>
</header>
<section data-field="subtitle" class="p-summary">
HTTPD Service is not Idempotent in Nature — Make it using Ansible
</section>
<section data-field="body" class="e-content">
<section name="f381" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="5017" id="5017" class="graf graf--h3 graf--leading graf--title">HTTPD Service is not Idempotent in Nature -- Make it using Ansible</h3><p name="079b" id="079b" class="graf graf--p graf-after--h3">HTTPD Service is not Idempotent in Nature — Make it using Ansible</p><p name="cef3" id="cef3" class="graf graf--p graf-after--p">Restarting HTTPD Service is not idempotence in nature and also consume more resources suggest a way to rectify this challenge in Ansible playbook</p><figure name="22bc" id="22bc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nErPui7tgH6n3WXKg1R6xA.png" data-width="668" data-height="274" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*nErPui7tgH6n3WXKg1R6xA.png"></figure><h3 name="a3da" id="a3da" class="graf graf--h3 graf-after--figure"><strong class="markup--strong markup--h3-strong">What is Ansible?</strong></h3><p name="93ce" id="93ce" class="graf graf--p graf-after--h3">Ansible is a radically simple IT automation engine that automates cloud provisioning, configuration management, application deployment, intra-service orchestration, and many other IT needs.</p><div name="9b93" id="9b93" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://tiybok45.medium.com/how-industries-are-solving-challenges-using-ansible-69c835962825" data-href="https://tiybok45.medium.com/how-industries-are-solving-challenges-using-ansible-69c835962825" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://tiybok45.medium.com/how-industries-are-solving-challenges-using-ansible-69c835962825"><strong class="markup--strong markup--mixtapeEmbed-strong"><em class="markup--em markup--mixtapeEmbed-em">How Industries Are Solving Challenges Using Ansible</em></strong><br>How Industries Are Solving Challenges Using Ansibletiybok45.medium.com</a><a href="https://tiybok45.medium.com/how-industries-are-solving-challenges-using-ansible-69c835962825" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="33f823e0451676f12630fca313c9d78f" data-thumbnail-img-id="1*QqN1OVK64OeM9uUf7SkSNg.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*QqN1OVK64OeM9uUf7SkSNg.png);"></a></div><h3 name="1249" id="1249" class="graf graf--h3 graf-after--mixtapeEmbed">What is Idempotency ?</h3><p name="2a41" id="2a41" class="graf graf--p graf-after--h3">An operation is idempotent if the result of performing it once is exactly the same as the result of performing it repeatedly without any intervening actions.</p><h3 name="ecd9" id="ecd9" class="graf graf--h3 graf-after--p">What is Apache Web Server?</h3><p name="b140" id="b140" class="graf graf--p graf-after--h3">Apache HTTP Server is a free and open-source web server that delivers web content through the internet. It is commonly referred to as Apache and after development, it quickly became the most popular HTTP client on the web. It’s widely thought that Apache gets its name from its development history and process of improvement through applied patches and modules but that was corrected back in 2000. It was revealed that the name originated from the respect of the Native American tribe for its resiliency and durability.</p><p name="9c61" id="9c61" class="graf graf--p graf-after--p">Apache supports a variety of features, many implemented as compiled modules which extend the core functionality. These can range from authentication schemes to supporting server-side programming languages such as Perl, Python, Tcl and PHP. Popular authentication modules include mod_access, mod_auth, mod_digest, and mod_auth_digest, the successor to mod_digest. A sample of other features include Secure Sockets Layer and Transport Layer Security support, a proxy module, a URL rewriting module, custom log files, and filtering support.</p><h3 name="ba70" id="ba70" class="graf graf--h3 graf-after--p">Understand Handlers?</h3><p name="2ae9" id="2ae9" class="graf graf--p graf-after--h3">Handlers are just like normal tasks in an <strong class="markup--strong markup--p-strong">Ansible</strong> playbook but they run only when if the Task contains a “<strong class="markup--strong markup--p-strong">notify</strong>” directive. It indicates that it changed something. And when any change is detected then it notifies the respective handler and the task completes.</p><p name="7300" id="7300" class="graf graf--p graf-after--p">Sometimes you want a task to run only when a change is made on a machine. For example, you may want to restart a service if a task updates the configuration of that service, but not if the configuration is unchanged. Ansible uses handlers to address this use case. Handlers are tasks that only run when notified. Each handler should have a globally unique name.</p><h3 name="9120" id="9120" class="graf graf--h3 graf-after--p">Idempotency in Ansible</h3><p name="3295" id="3295" class="graf graf--p graf-after--h3"><em class="markup--em markup--p-em">Idempotence</em> is “the property of certain operations in mathematics and computer science that can be applied multiple times without changing the result beyond the initial application”. For Ansible it means after 1 run of a playbook to set things to a desired state, further runs of the same playbook should result in 0 changes. In simplest terms, idempotency means you can be sure of a consistent state in your environment.</p><h3 name="a59e" id="a59e" class="graf graf--h3 graf-after--p">Task Objective:-</h3><p name="a97d" id="a97d" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Statement: </strong>Restarting HTTPD Service is not idempotence in nature and also consume more resources to suggest a way to rectify this challenge in the ansible playbook.</p><p name="aebd" id="aebd" class="graf graf--p graf-after--p">Let’s see how you can make httpd module idempotence in nature.</p><p name="5d0e" id="5d0e" class="graf graf--p graf-after--p">To solving the above problem, we will use two keywords in our ansible-playbook.</p><p name="0109" id="0109" class="graf graf--p graf-after--p">Keywords used to make <strong class="markup--strong markup--p-strong">httpd service is idempotence</strong> are as follows:-</p><p name="0c9b" id="0c9b" class="graf graf--p graf-after--p">1) Notify</p><p name="541c" id="541c" class="graf graf--p graf-after--p">2) Handler</p><p name="b765" id="b765" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Steps to be followed:-</strong></p><p name="e6d2" id="e6d2" class="graf graf--p graf-after--p">I am using RedHat Linux 8 on Virtual Machine for performing this task.</p><p name="d7e8" id="d7e8" class="graf graf--p graf-after--p">We use two Redhat VM, one for C<strong class="markup--strong markup--p-strong">ontroller node </strong>and other for <strong class="markup--strong markup--p-strong">Managed node or Slave node. </strong>As you can see in below image the VM of name <strong class="markup--strong markup--p-strong">Arth Ansible</strong> will be our <strong class="markup--strong markup--p-strong">Controller node</strong> and the VM of name <strong class="markup--strong markup--p-strong">Redhat 8</strong> will be our <strong class="markup--strong markup--p-strong">Managed node</strong></p><figure name="961e" id="961e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ztUwkcq2SbQ65z-GhD_WbA.png" data-width="2354" data-height="1874" src="https://cdn-images-1.medium.com/max/800/1*ztUwkcq2SbQ65z-GhD_WbA.png"></figure><p name="20b0" id="20b0" class="graf graf--p graf-after--figure">Before that check if python3 is intalled or not using command <strong class="markup--strong markup--p-strong">python3 -V</strong> .</p><p name="b2dd" id="b2dd" class="graf graf--p graf-after--p">Check if ansible is installed or not using command <strong class="markup--strong markup--p-strong">ansible --version</strong> and if not installed than use command <strong class="markup--strong markup--p-strong">yum install ansible</strong> to installed it.</p><figure name="ea53" id="ea53" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8TjzeAMu801H9zdUkjXG3w.png" data-width="2326" data-height="1982" src="https://cdn-images-1.medium.com/max/800/1*8TjzeAMu801H9zdUkjXG3w.png"></figure><p name="47b4" id="47b4" class="graf graf--p graf-after--figure">Check Managed Node / Slave node IP address using command <strong class="markup--strong markup--p-strong">ifconfig </strong>on terminal</p><figure name="8843" id="8843" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*IoCjwHj-VuzpOL7eA22iTg.png" data-width="2326" data-height="1982" src="https://cdn-images-1.medium.com/max/800/1*IoCjwHj-VuzpOL7eA22iTg.png"></figure><p name="d8e1" id="d8e1" class="graf graf--p graf-after--figure">Setting the Slave node configuration file so that our ansible system can connect to the target node. Created the host-file which contains all this info of slave node in dir (/etc/ansible/hosts)</p><figure name="ac1a" id="ac1a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*sgOyyTwhAihN_PW1V2SyOA.png" data-width="2326" data-height="1982" src="https://cdn-images-1.medium.com/max/800/1*sgOyyTwhAihN_PW1V2SyOA.png"></figure><p name="4258" id="4258" class="graf graf--p graf-after--figure">Creating the ansible.cfg which is configuration file for ansible and storing their our inventory.</p><figure name="47be" id="47be" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*OofnDMBz88ReyVerF9B4UA.png" data-width="2326" data-height="1982" src="https://cdn-images-1.medium.com/max/800/1*OofnDMBz88ReyVerF9B4UA.png"></figure><p name="8157" id="8157" class="graf graf--p graf-after--figure">To check our list of nodes present in our inventory file use command</p><p name="7940" id="7940" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">ansible all --list-hosts</strong></p><figure name="292a" id="292a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*y3wsFK211oe2DDf6OqxRkA.png" data-width="2326" data-height="1982" src="https://cdn-images-1.medium.com/max/800/1*y3wsFK211oe2DDf6OqxRkA.png"></figure><p name="5f7d" id="5f7d" class="graf graf--p graf-after--figure">Before running our ansible playbook we have to check our connection with managed node for that use command</p><p name="bd04" id="bd04" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">ansible all -m ping</strong></p><figure name="ee8c" id="ee8c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*y3wsFK211oe2DDf6OqxRkA.png" data-width="2326" data-height="1982" src="https://cdn-images-1.medium.com/max/800/1*y3wsFK211oe2DDf6OqxRkA.png"></figure><p name="991c" id="991c" class="graf graf--p graf-after--figure">As you can see that there is message “ping: pong” which means our managed node is successfully connected with our controller node.</p><p name="81ef" id="81ef" class="graf graf--p graf-after--p">Created a ansible playbook and in this playbook we had configured yum repository for docker and installed docker package and through pip we had installed the docker sdk, Also started the docker service.</p><p name="3cd8" id="3cd8" class="graf graf--p graf-after--p">Making our workspace and writing their our yaml file.</p><p name="a775" id="a775" class="graf graf--p graf-after--p">Writing the handler.conf file</p><figure name="8065" id="8065" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*t8WvaozUlSo-4VBwLcBkHQ.png" data-width="1757" data-height="1194" src="https://cdn-images-1.medium.com/max/800/1*t8WvaozUlSo-4VBwLcBkHQ.png"></figure><p name="44f9" id="44f9" class="graf graf--p graf-after--figure">Writing the index.html file</p><figure name="0c9d" id="0c9d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*OERluPUrCOV93kl8Qdwk-Q.png" data-width="1761" data-height="1191" src="https://cdn-images-1.medium.com/max/800/1*OERluPUrCOV93kl8Qdwk-Q.png"></figure><p name="7c18" id="7c18" class="graf graf--p graf-after--figure">In this playbook we have installed Apache Web-Server, Copied out html code, Created a template and Handler.</p><figure name="d537" id="d537" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*WXzfaG6auJOE3ydVQ6FF5Q.png" data-width="1747" data-height="1122" src="https://cdn-images-1.medium.com/max/800/1*WXzfaG6auJOE3ydVQ6FF5Q.png"></figure><figure name="5b06" id="5b06" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*qMlLaHZqOIJ66nkJcbv4kQ.png" data-width="1754" data-height="1195" src="https://cdn-images-1.medium.com/max/800/1*qMlLaHZqOIJ66nkJcbv4kQ.png"></figure><p name="6097" id="6097" class="graf graf--p graf-after--figure">Here, as you can see in this<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> Playbook</em></strong> I have used <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Handlers</em></strong> and<strong class="markup--strong markup--p-strong"> Notify </strong>keyword before <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Service Module</em></strong>.</p><p name="7bfc" id="7bfc" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Handlers</em></strong> are just like normal tasks in<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> Ansible Playbook</em></strong> but they execute only when the task contains<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> notify</em></strong> directive. It indicates that something has been <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">changed</em></strong> in the task.</p><p name="32fb" id="32fb" class="graf graf--p graf-after--p">So, after starting the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">HTTPD services once</em></strong>, if we try to<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> restart </em></strong>the service again <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">without modifying</em></strong> the<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> Index file</em></strong> of Web Server, service will <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">not be</em></strong> restarted.</p><p name="18fa" id="18fa" class="graf graf--p graf-after--p">HTTPD service will be <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">restarted </em></strong>only when <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">index file is modified</em></strong>. This <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">saves</em></strong> the Server from<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> restarting again</em></strong> and again and also<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> saves Resources.</em></strong></p><p name="b828" id="b828" class="graf graf--p graf-after--p">Using <strong class="markup--strong markup--p-strong">ansible-playbook command </strong>to run the playbook</p><figure name="4908" id="4908" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*DbbvxITPgj03J0yD9eReTQ.png" data-width="1755" data-height="1188" src="https://cdn-images-1.medium.com/max/800/1*DbbvxITPgj03J0yD9eReTQ.png"></figure><p name="ef13" id="ef13" class="graf graf--p graf-after--figure">Now, as you can see <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Web Server</em></strong> has been <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">configured successfully</em></strong>..!</p><figure name="aa7b" id="aa7b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*s9kr0Fl76XjTZUAlNEkDhQ.png" data-width="3296" data-height="2146" src="https://cdn-images-1.medium.com/max/800/1*s9kr0Fl76XjTZUAlNEkDhQ.png"></figure><p name="83e1" id="83e1" class="graf graf--p graf-after--figure">Now, If we try to<strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em"> restart </em></strong>the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">HTTPD service</em></strong> again, <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Handlers</em></strong> will <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">not execute</em></strong> and hence service will <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">not be restarted </em></strong>as the index file of the Server has not been modified.</p><p name="b798" id="b798" class="graf graf--p graf-after--p">Handlers were not excuted as nothing was not modified.</p><figure name="2061" id="2061" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xBRj2334bi6AJNPLsQw8GQ.png" data-width="1760" data-height="1188" src="https://cdn-images-1.medium.com/max/800/1*xBRj2334bi6AJNPLsQw8GQ.png"></figure><p name="20a2" id="20a2" class="graf graf--p graf-after--figure">Now, lets <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">modify</em></strong> the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">index file</em></strong> of the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Web Server</em></strong> before restarting services.</p><figure name="84ac" id="84ac" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*2g7wIIb-sqLqb9cZUQDEag.png" data-width="1968" data-height="1329" src="https://cdn-images-1.medium.com/max/800/1*2g7wIIb-sqLqb9cZUQDEag.png"></figure><p name="8fa2" id="8fa2" class="graf graf--p graf-after--figure">And also <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">modify</em></strong> the <strong class="markup--strong markup--p-strong">http_port</strong> of the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Web Server (httpd_ansible) </em></strong>before restarting services.</p><figure name="7b69" id="7b69" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8T32cbNE1vT3r0kfZ7XD6w.png" data-width="1967" data-height="1332" src="https://cdn-images-1.medium.com/max/800/1*8T32cbNE1vT3r0kfZ7XD6w.png"></figure><figure name="7d85" id="7d85" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*t1YGBFJ4zi82hKFBixwUPQ.png" data-width="1964" data-height="1330" src="https://cdn-images-1.medium.com/max/800/1*t1YGBFJ4zi82hKFBixwUPQ.png"></figure><p name="ae0a" id="ae0a" class="graf graf--p graf-after--figure">Stop HTTPD service from <strong class="markup--strong markup--p-strong">Managed (slave) node</strong>:</p><figure name="1372" id="1372" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*LEJg8HnQnhsvR1GPyNPxnw.png" data-width="1842" data-height="1260" src="https://cdn-images-1.medium.com/max/800/1*LEJg8HnQnhsvR1GPyNPxnw.png"></figure><p name="9802" id="9802" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Re-starting </em></strong>HTTPD service:</p><p name="ac87" id="ac87" class="graf graf--p graf-after--p">As the index file and http_port of web server was modified HTTP service was restarted</p><figure name="c051" id="c051" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*2TgC1O3_G9AzNCeEsiGqyg.png" data-width="1964" data-height="1330" src="https://cdn-images-1.medium.com/max/800/1*2TgC1O3_G9AzNCeEsiGqyg.png"></figure><p name="15d6" id="15d6" class="graf graf--p graf-after--figure">Now, as you can see <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">HTTPD service</em></strong> has been <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">restarted</em></strong> as the index file was modified.</p><figure name="2256" id="2256" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*V3Pe2OvDWZoa0cLjTgqPPQ.png" data-width="3296" data-height="2146" src="https://cdn-images-1.medium.com/max/800/1*V3Pe2OvDWZoa0cLjTgqPPQ.png"></figure><p name="3da0" id="3da0" class="graf graf--p graf-after--figure">Hence, It proves that HTTPD service can be made Idempotent in nature using Handlers in Ansible.</p><h3 name="0861" id="0861" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="c9aa" id="c9aa" class="graf graf--p graf-after--h3 graf--trailing">We proved the HTTPD service can be made Idempotent in nature using Handlers in Ansible and learned how to do it.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@tiybok45" class="p-author h-card">Rutvik Bhalerao</a> on <a href="https://medium.com/p/fce8d665983a"><time class="dt-published" datetime="2022-06-11T17:41:12.928Z">June 11, 2022</time></a>.</p><p><a href="https://medium.com/@tiybok45/httpd-service-is-not-idempotent-in-nature-make-it-using-ansible-fce8d665983a" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 22, 2022.</p></footer></article></body></html>